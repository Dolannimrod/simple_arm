<?xml version='1.0'?>

<robot name="pick_place" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="$(find pick_place_arms)/urdf/place.gazebo" />
    <xacro:include filename="$(find pick_place_arms)/urdf/material.xacro" />

    <!-- Robot footprint -->
    <link name="base_footprint"></link>

      <joint name="base_joint" type="fixed">
        <parent link="base_footprint"/>
        <child link="base_link"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
      </joint>

    <!-- Include the base_link-->
  <link name='base_link'>
      <pose>0 0 0 0 0 0</pose>

      <inertial>
        <mass value="15.0"/>
        <origin xyz="0.0 0 0" rpy=" 0 0 0"/>
          <inertia
              ixx="0.0625" ixy="0" ixz="0"
              iyy="0.2125" iyz="0"
              izz="0.25"
          />
      </inertial>

      <collision name='collision'>
        <origin xyz="0 0 0" rpy=" 0 0 0"/> 
          <geometry>
            <box size="0.4 0.2 0.1"/>
          </geometry>
      </collision>

      <visual name='base_link_visual'>
        <origin xyz="0 0 0" rpy=" 01.57 0 0"/>
        <geometry>
          <mesh filename ="package://pick_place_arms/meshes/Base.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="gray"/>
      </visual>
    </link>

    <joint name="arm_joint" type="revolute">
      <parent link="base_link"/>
      <child link="shoulder_link"/>
      <origin xyz="0 0 0.01" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="-1.57" upper="1.57" effort="10" velocity="1.0"/>
    </joint>

    <!-- Shoulder link -->
    <link name="shoulder_link">
      <pose>0 0 0 0 0 0</pose>

      <inertial>
        <mass value="5.0"/>
        <origin xyz="0.0 0 0.1" rpy=" 0 0 0"/>
          <inertia
              ixx="0.02" ixy="0" ixz="0"
              iyy="0.02" iyz="0"
              izz="0.005"
          />
      </inertial>

      <collision name='collision'>
        <origin xyz="0 0 0.1" rpy=" 0 0 0"/> 
          <geometry>
            <cylinder radius="0.05" length="0.2"/>
          </geometry>
      </collision>

      <visual name='shoulder_link_visual'>
        <origin xyz="0 0 0.0001" rpy=" 1.57 0 0"/>
        <geometry>
          <mesh filename ="package://pick_place_arms/meshes/Shoulder.stl" scale="0.001 0.001 0.001"/>
        </geometry>
        <material name="gray"/>
      </visual>
    </link>

    <joint name="elbow_joint" type="revolute">
      <parent link="shoulder_link"/>
      <child link="arm_link"/>
      <origin xyz="0 0 0.015" rpy="0 0 0"/>
      <axis xyz="1 0 0"/>
      <limit lower="-1.57" upper="1.57" effort="10" velocity="1.0"/>
    </joint>

    <!-- Arm link -->
    <link name="arm_link">
      <pose>0 0 0 0 0 0</pose>
      <inertial>
        <mass value="3.0"/>
        <origin xyz="0 0 0" rpy=" 0 0 0"/>
          <inertia
              ixx="0.01" ixy="0" ixz="0"
              iyy="0.01" iyz="0"
              izz="0.003"
          />
      </inertial>

      <collision name='collision'>
        <origin xyz="0 0 0.1" rpy=" 0 0 0"/> 
          <geometry>
            <cylinder radius="0.04" length="0.2"/>
          </geometry>
      </collision>

      <visual name='arm_link_visual'>
        <origin xyz="0.0085 0 0.045" rpy=" -1.57 0 1.57"/>
        <geometry>
          <mesh filename ="package://pick_place_arms/meshes/Shoulder_arm.stl" scale="0.001 0.001 0.001" />
        </geometry>
        <material name="blue"/>
      </visual>
    </link>  

    <joint name="gripper_joint" type="revolute">
      <parent link="arm_link"/>
      <child link="gripper_link"/>
        <origin xyz="0 0 0.0315" rpy="0 0 0"/>
        <axis xyz="1 0 0"/>
        <limit lower="-1.57" upper="1.57" effort="10" velocity="1.0"/>
    </joint>

    <!-- Gripper link -->
    <link name="gripper_link">
      <pose>0 0 0 0 0 0</pose>
      <inertial>
        <mass value="1.0"/>
        <origin xyz="0 0 0" rpy=" 0 0 0"/>
          <inertia
              ixx="0.005" ixy="0" ixz="0"
              iyy="0.005" iyz="0"
              izz="0.002"
          />
      </inertial>

      <collision name='collision'>
        <origin xyz="0 0 0.05" rpy=" 0 0 0"/> 
          <geometry>
            <box size="0.1 0.1 0.1"/>
          </geometry>
      </collision>

      <visual name='gripper_link_visual'>
        <origin xyz="0 0 0" rpy=" -1.57 0 0"/>
        <geometry>
          <mesh filename ="package://pick_place_arms/meshes/arm.stl" scale="0.0015 0.0015 0.0015"/>
        </geometry>
        <material name="blue"/>
      </visual>
    </link>

    <joint name="gripper_left_finger_joint" type="prismatic">
      <parent link="gripper_link"/>
      <child link="gripper_left_finger_link"/>
        <origin xyz="0 0 0.03" rpy="0 0 0"/>
        <axis xyz="1 0 0"/>
         <limit lower="0" upper="0.004" effort="100.0" velocity="4.0"/>
    </joint>

  <gazebo reference="gripper_left_finger_joint">
    <kp>1000000.0</kp>
    <kd>100.0</kd>
    <mu1>15</mu1>
    <mu2>15</mu2>
    <fdir1>1 0 0</fdir1>
    <maxVel>1.0</maxVel>
    <minDepth>0.002</minDepth>
  </gazebo>

    <!-- Gripper left finger link -->

    <link name="gripper_left_finger_link">
      <pose>0 0 0 0 0 0</pose>

      <inertial>
        <mass value="0.2"/>
        <origin xyz="0 0 0" rpy=" 0 0 0"/>
        <inertia
            ixx="0.0005" ixy="0" ixz="0"
            iyy="0.0005" iyz="0"
            izz="0.0002"
        />  
      </inertial>

      <collision name='collision'>
        <origin xyz="0.0 0.0 0.025" rpy=" 0 0 0"/> 
          <geometry>
            <box size="0.02 0.05 0.05"/>
          </geometry>
      </collision>

      <visual name='gripper_left_finger_link_visual'>
        <origin xyz="0 0 0.009" rpy=" 1.57 0 1.57"/>
        <geometry>
          <mesh filename ="package://pick_place_arms/meshes/Left gripper.stl" scale="0.0015 0.0015 0.0015"/>
        </geometry>
        <material name="green"/>
      </visual>
    </link>
    
    <joint name="gripper_right_finger_joint" type="prismatic">
      <parent link="gripper_link"/>
      <child link="gripper_right_finger_link"/>
        <origin xyz="0 0 0.03" rpy="0 0 0"/>
        <axis xyz="1 0 0"/>
        <limit lower="-0.004" upper="0" effort="5" velocity="1.0"/>
    </joint>

    <!-- Gripper right finger link -->
    <link name="gripper_right_finger_link">
      <pose>0 0 0 0 0 0</pose>

      <inertial>
        <mass value="0.2"/>
        <origin xyz="0 0 0" rpy=" 0 0 0"/>
        <inertia
            ixx="0.0005" ixy="0" ixz="0"
            iyy="0.0005" iyz="0"
            izz="0.0002"
        />  
      </inertial>

      <collision name='collision'>
        <origin xyz="0.0 0.0 0.025" rpy=" 0 0 0"/> 
          <geometry>
            <box size="0.02 0.05 0.05"/>
          </geometry>
      </collision>

      <visual name='gripper_right_finger_link_visual'>
        <origin xyz="0 0 0.009" rpy=" 1.57 0 1.57"/>
        <geometry>
          <mesh filename ="package://pick_place_arms/meshes/Right gripper.stl" scale="0.0015 0.0015 0.0015"/>
        </geometry>
        <material name="green"/>
      </visual>
    </link>

  <gazebo reference="gripper_right_finger_link">
    <kp>1000000.0</kp>
    <kd>100.0</kd>
    <mu1>15</mu1>
    <mu2>15</mu2>
    <fdir1>1 0 0</fdir1>
    <maxVel>1.0</maxVel>
    <minDepth>0.002</minDepth>
  </gazebo>

      <!-- ROS2 control -->
  <ros2_control name="GazeboSystem" type="system">
    <hardware>
       <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>

    <joint name="arm_joint">
      <command_interface name="position">
        <param name="min">-2</param>
        <param name="max">2</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>

    <joint name="elbow_joint">
      <command_interface name="position">
        <param name="min">-2</param>
        <param name="max">2</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>

    <joint name="gripper_joint">
      <command_interface name="position">
        <param name="min">-2</param>
        <param name="max">2</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>

    <joint name="gripper_left_finger_joint">
      <command_interface name="position">
        <param name="min">-2</param>
        <param name="max">2</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>

    <joint name="gripper_right_finger_joint">
      <command_interface name="position">
        <param name="min">-2</param>
        <param name="max">2</param>
      </command_interface>
      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
  </ros2_control>
</robot>